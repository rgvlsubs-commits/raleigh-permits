{% extends "base.html" %}

{% block title %}Economy | Raleigh Insights{% endblock %}

{% block head_extra %}
{% endblock %}

{% block content %}
<div class="page-header">
    <h2 class="page-title">The Economic Pulse of Raleigh</h2>
    <p class="page-subtitle">National Context, Regional Performance, and Local Industry Dynamics</p>
</div>

<!-- NATIONAL INDICATORS - Headline Context -->
<section class="geo-section national-section">
    <h3 class="geo-header">U.S. Economy</h3>
    <div class="stats-container national-stats">
        <div class="stat-card national">
            <span class="stat-value" id="us-gdp-growth">--</span>
            <span class="stat-label">Real GDP Growth (YoY)</span>
        </div>
        <div class="stat-card national">
            <span class="stat-value" id="us-unemployment">--</span>
            <span class="stat-label">Unemployment Rate</span>
        </div>
        <div class="stat-card national">
            <span class="stat-value" id="us-wage-growth">--</span>
            <span class="stat-label">Real Wage Growth (YoY)</span>
        </div>
        <div class="stat-card national">
            <span class="stat-value" id="us-inflation">--</span>
            <span class="stat-label">Core PCE Inflation (YoY)</span>
        </div>
    </div>
</section>

<!-- RALEIGH MSA INDICATORS - Main Focus -->
<section class="geo-section raleigh-section">
    <h3 class="geo-header">Raleigh-Cary MSA</h3>
    <div class="stats-container raleigh-stats">
        <div class="stat-card">
            <span class="stat-value" id="unemployment-rate">--</span>
            <span class="stat-label">Unemployment Rate</span>
        </div>
        <div class="stat-card">
            <span class="stat-value" id="total-employment">--</span>
            <span class="stat-label">Nonfarm Employment (K)</span>
        </div>
        <div class="stat-card">
            <span class="stat-value" id="gdp">--</span>
            <span class="stat-label">Real GDP ($B)</span>
        </div>
        <div class="stat-card">
            <span class="stat-value" id="per-capita-income">--</span>
            <span class="stat-label">Per Capita Income</span>
        </div>
        <div class="stat-card">
            <span class="stat-value" id="home-price-growth">--</span>
            <span class="stat-label">Home Price Growth (YoY)</span>
        </div>
    </div>
</section>

<!-- METRO COMPARISON - Collapsible Peer Comparison -->
<section class="comparison-section">
    <div class="narrative-box" id="metro-comparison-box">
        <div class="narrative-header">
            <span class="narrative-title">How Does Raleigh Compare to Peer Metros?</span>
            <span class="narrative-toggle">&#9660;</span>
        </div>
        <div class="narrative-content comparison-content">
            <p class="comparison-intro">Comparing Raleigh-Cary against Nashville, Austin, Charlotte, and Denver - similar high-growth metros competing for talent and investment.</p>

            <div class="table-wrapper comparison-table-wrapper">
                <table id="metro-comparison-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th class="metro-col raleigh-col">Raleigh</th>
                            <th class="metro-col">Nashville</th>
                            <th class="metro-col">Austin</th>
                            <th class="metro-col">Charlotte</th>
                            <th class="metro-col">Denver</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Unemployment Rate</td>
                            <td class="raleigh-col" id="cmp-raleigh-unemployment">--</td>
                            <td id="cmp-nashville-unemployment">--</td>
                            <td id="cmp-austin-unemployment">--</td>
                            <td id="cmp-charlotte-unemployment">--</td>
                            <td id="cmp-denver-unemployment">--</td>
                        </tr>
                        <tr>
                            <td>Job Growth (YoY)</td>
                            <td class="raleigh-col" id="cmp-raleigh-job-growth">--</td>
                            <td id="cmp-nashville-job-growth">--</td>
                            <td id="cmp-austin-job-growth">--</td>
                            <td id="cmp-charlotte-job-growth">--</td>
                            <td id="cmp-denver-job-growth">--</td>
                        </tr>
                        <tr>
                            <td>Home Price Growth (YoY)</td>
                            <td class="raleigh-col" id="cmp-raleigh-home-price">--</td>
                            <td id="cmp-nashville-home-price">--</td>
                            <td id="cmp-austin-home-price">--</td>
                            <td id="cmp-charlotte-home-price">--</td>
                            <td id="cmp-denver-home-price">--</td>
                        </tr>
                        <tr>
                            <td>Per Capita Income</td>
                            <td class="raleigh-col" id="cmp-raleigh-income">--</td>
                            <td id="cmp-nashville-income">--</td>
                            <td id="cmp-austin-income">--</td>
                            <td id="cmp-charlotte-income">--</td>
                            <td id="cmp-denver-income">--</td>
                        </tr>
                        <tr>
                            <td>Real GDP</td>
                            <td class="raleigh-col" id="cmp-raleigh-gdp">--</td>
                            <td id="cmp-nashville-gdp">--</td>
                            <td id="cmp-austin-gdp">--</td>
                            <td id="cmp-charlotte-gdp">--</td>
                            <td id="cmp-denver-gdp">--</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="comparison-chart-container">
                <h4>Unemployment Rate Trend</h4>
                <canvas id="metro-unemployment-chart"></canvas>
            </div>

            <div class="comparison-insights">
                <h4>Key Takeaways</h4>
                <ul>
                    <li><strong>Labor market strength:</strong> Raleigh consistently has lower unemployment than peers</li>
                    <li><strong>Balanced growth:</strong> Strong job creation without overheating</li>
                    <li><strong>Affordability edge:</strong> Home prices rising slower than Austin/Nashville</li>
                    <li><strong>Watch areas:</strong> Per capita income trails Denver and Austin; Charlotte is a direct NC competitor</li>
                </ul>
            </div>

            <p class="context-note">Peer metros selected for similar growth trajectory, knowledge economy focus, and quality-of-life positioning. Data from FRED.</p>
        </div>
    </div>
</section>

<!-- NC STATE INDICATORS - State Context -->
<section class="geo-section nc-section">
    <h3 class="geo-header">North Carolina</h3>
    <div class="stats-container nc-stats">
        <div class="stat-card nc">
            <span class="stat-value" id="nc-unemployment">--</span>
            <span class="stat-label">Unemployment Rate</span>
        </div>
        <div class="stat-card nc">
            <span class="stat-value" id="nc-employment">--</span>
            <span class="stat-label">Nonfarm Employment (M)</span>
        </div>
        <div class="stat-card nc">
            <span class="stat-value" id="nc-income">--</span>
            <span class="stat-label">Per Capita Income</span>
        </div>
    </div>
</section>

<div class="narrative-box collapsed">
    <div class="narrative-header">
        <span class="narrative-title">Reading the Data: National to Local</span>
        <span class="narrative-toggle">&#9660;</span>
    </div>
    <div class="narrative-content">
        <h4>Why three levels matter</h4>
        <ul>
            <li><strong>National conditions set the baseline.</strong> Fed policy, inflation, and GDP growth affect all markets. Watch for recession signals.</li>
            <li><strong>Raleigh typically outperforms.</strong> MSA unemployment runs 0.5-1% below national; job growth is 2x the national rate.</li>
            <li><strong>NC provides regional context.</strong> State-level data reveals whether Raleigh is driving state growth or benefiting from broader trends.</li>
        </ul>
        <h4>Key comparisons to watch</h4>
        <ul>
            <li><strong>Unemployment gap:</strong> Raleigh vs. US and NC-when gaps narrow, local advantage is shrinking.</li>
            <li><strong>Income convergence:</strong> Raleigh income rising toward national average signals maturing economy.</li>
            <li><strong>Job growth differential:</strong> Raleigh consistently adds jobs faster than state and nation.</li>
        </ul>
        <p class="context-note">Data from Federal Reserve Economic Data (FRED). National GDP is quarterly; unemployment is monthly; income is annual. Some series have 1-2 month reporting lag.</p>
    </div>
</div>

<div id="api-status" class="api-status-banner hidden">
    <strong>Note:</strong> <span id="api-status-message"></span>
</div>

<section class="charts-section">
    <div class="chart-container full-width">
        <div class="chart-header">
            <h2>Labor Market Trends</h2>
            <div class="chart-controls">
                <select id="labor-metric-select">
                    <option value="unemployment_rate">Unemployment Rate</option>
                    <option value="employment">Total Employment</option>
                    <option value="labor_force">Labor Force</option>
                </select>
            </div>
        </div>
        <canvas id="labor-chart"></canvas>
        <div class="narrative-box collapsed">
            <div class="narrative-header">
                <span class="narrative-title">The Labor Market Story</span>
                <span class="narrative-toggle">&#9660;</span>
            </div>
            <div class="narrative-content">
                <h4>What the data shows</h4>
                <ul>
                    <li><strong>Post-pandemic recovery was swift.</strong> Unemployment peaked at 12% in April 2020 but fell below 4% by early 2022-faster than most metros.</li>
                    <li><strong>Labor force keeps growing.</strong> Net in-migration adds 50,000+ working-age residents annually to the metro.</li>
                    <li><strong>Tight labor market persists.</strong> Employers report difficulty filling roles, especially in tech, healthcare, and skilled trades.</li>
                </ul>
                <h4>The participation puzzle</h4>
                <ul>
                    <li><strong>Prime-age participation is strong</strong> at 84% vs. 83% nationally-but childcare costs remain a barrier.</li>
                    <li><strong>Remote work is reshaping commute patterns.</strong> Downtown office occupancy at 60% of pre-pandemic, but suburban office parks are fuller.</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<section class="charts-section">
    <div class="chart-container">
        <div class="chart-header">
            <h2>Industry Composition</h2>
        </div>
        <canvas id="industry-chart"></canvas>
    </div>
    <div class="chart-container">
        <div class="chart-header">
            <h2>Employment by Sector</h2>
        </div>
        <canvas id="employment-sector-chart"></canvas>
    </div>
</section>

<div class="narrative-box collapsed">
    <div class="narrative-header">
        <span class="narrative-title">What Industries Drive Raleigh?</span>
        <span class="narrative-toggle">&#9660;</span>
    </div>
    <div class="narrative-content">
        <h4>The economic engines</h4>
        <ul>
            <li><strong>Healthcare is the largest employer.</strong> WakeMed, Duke Health, and UNC Health employ 50,000+ in the metro.</li>
            <li><strong>Tech/Professional services punch above weight.</strong> IBM, Cisco, Red Hat, Epic Games, and hundreds of startups.</li>
            <li><strong>Education anchors stability.</strong> NC State alone has 12,000 employees; public schools add another 20,000.</li>
        </ul>
        <h4>Industry diversity = resilience</h4>
        <ul>
            <li><strong>No single sector dominates.</strong> The top 3 industries account for <50% of employment-lower concentration than peer metros.</li>
            <li><strong>Manufacturing is rebounding.</strong> EV battery plants, pharma, and biotech are adding production capacity.</li>
            <li><strong>Hospitality recovered last</strong> but now exceeds pre-pandemic employment as tourism and conventions return.</li>
        </ul>
    </div>
</div>

<section class="charts-section">
    <div class="chart-container full-width">
        <div class="chart-header">
            <h2>Economic Growth</h2>
            <div class="chart-controls">
                <select id="growth-metric-select">
                    <option value="gdp">Real GDP</option>
                    <option value="per_capita_income">Per Capita Income</option>
                    <option value="personal_income">Total Personal Income</option>
                </select>
            </div>
        </div>
        <canvas id="growth-chart"></canvas>
        <div class="narrative-box collapsed">
            <div class="narrative-header">
                <span class="narrative-title">Growth That Outpaces the Nation</span>
                <span class="narrative-toggle">&#9660;</span>
            </div>
            <div class="narrative-content">
                <h4>GDP growth story</h4>
                <ul>
                    <li><strong>Real GDP grew 4.5% annually</strong> (2015-2023) vs. 2.1% nationally-one of the fastest-growing metros.</li>
                    <li><strong>$100B+ economy.</strong> Raleigh-Cary MSA GDP exceeds many states (Wyoming, Vermont, Alaska).</li>
                    <li><strong>Per capita income rising</strong> but still 8% below national average-a sign of remaining affordability.</li>
                </ul>
                <h4>Income dynamics</h4>
                <ul>
                    <li><strong>Wage growth is strong</strong> in tech and healthcare, but service sector wages lag.</li>
                    <li><strong>Cost of living adjustment:</strong> Raleigh salaries are ~15% below Bay Area but COL is 40% lower.</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- GLOBAL TRADE SECTION -->
<section class="geo-section trade-section">
    <h3 class="geo-header">Global Trade</h3>
    <p class="section-subtitle">Raleigh's Connection to the World Economy</p>
    <div class="stats-container trade-stats">
        <div class="stat-card">
            <span class="stat-value" id="total-exports">--</span>
            <span class="stat-label">Total Exports (2023)</span>
        </div>
        <div class="stat-card">
            <span class="stat-value" id="export-growth">--</span>
            <span class="stat-label">YoY Growth</span>
        </div>
        <div class="stat-card">
            <span class="stat-value" id="triangle-exports">--</span>
            <span class="stat-label">Triangle Region Total</span>
        </div>
        <div class="stat-card">
            <span class="stat-value" id="nc-share">--</span>
            <span class="stat-label">Share of NC Exports</span>
        </div>
    </div>
</section>

<section class="charts-section">
    <div class="chart-container">
        <div class="chart-header">
            <h2>Top Export Industries</h2>
        </div>
        <canvas id="export-industries-chart"></canvas>
    </div>
    <div class="chart-container">
        <div class="chart-header">
            <h2>Top Destination Countries</h2>
        </div>
        <canvas id="export-destinations-chart"></canvas>
    </div>
</section>

<section class="charts-section">
    <div class="chart-container full-width">
        <div class="chart-header">
            <h2>Export Trend</h2>
        </div>
        <canvas id="export-trend-chart"></canvas>
    </div>
</section>

<div class="narrative-box collapsed">
    <div class="narrative-header">
        <span class="narrative-title">Raleigh in the Global Economy</span>
        <span class="narrative-toggle">&#9660;</span>
    </div>
    <div class="narrative-content">
        <h4>Why trade matters</h4>
        <ul>
            <li><strong>$6 billion in exports</strong> makes Raleigh a top-50 metro exporter nationally.</li>
            <li><strong>Pharmaceuticals dominate</strong> (30% of exports) - GSK, Biogen, and 200+ life science firms drive global sales.</li>
            <li><strong>Tech hardware growing</strong> - computer and electronics exports up 15% since 2020.</li>
        </ul>
        <h4>Key trading partners</h4>
        <ul>
            <li><strong>NAFTA/USMCA partners (Canada, Mexico)</strong> account for 32% of exports - supply chain integration is deep.</li>
            <li><strong>China</strong> is the #2 destination despite trade tensions - pharma and tech demand remains strong.</li>
            <li><strong>Europe (France, Germany, UK)</strong> is growing - pharmaceutical exports to EU up 20% since 2021.</li>
        </ul>
        <h4>Looking ahead</h4>
        <ul>
            <li><strong>EV supply chain</strong> - new battery plants will boost machinery and equipment exports.</li>
            <li><strong>Biotech expansion</strong> - gene therapy and vaccine production scaling for global markets.</li>
            <li><strong>RDU international flights</strong> - direct routes to Paris and London support business travel and trade relationships.</li>
        </ul>
        <p class="context-note">Data from <a href="https://www.trade.gov/ita-metropolitan-export-series" target="_blank">ITA Metropolitan Export Series</a>. Export values are for goods only; services exports (substantial in tech/consulting) are not included.</p>
    </div>
</div>

<section class="table-section">
    <h2>Business Activity by Zip Code</h2>
    <p class="section-subtitle">Census ZIP Code Business Patterns (2021)</p>
    <div class="table-wrapper">
        <table id="zip-table">
            <thead>
                <tr>
                    <th class="sortable" data-sort="zip">Zip Code</th>
                    <th class="sortable" data-sort="ring">Ring</th>
                    <th class="sortable desc" data-sort="establishments">Establishments</th>
                    <th class="sortable" data-sort="employees">Employees</th>
                    <th class="sortable" data-sort="payroll">Payroll ($M)</th>
                    <th class="sortable" data-sort="avg_wage">Avg Wage</th>
                </tr>
            </thead>
            <tbody id="zip-tbody"></tbody>
        </table>
    </div>
</section>

<div id="loading" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>Loading economic data from FRED and Census...</p>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/economy.js') }}"></script>
{% endblock %}

{% block footer_sources %}
| <a href="https://fred.stlouisfed.org/" target="_blank">Federal Reserve (FRED)</a>
| <a href="https://www.census.gov/programs-surveys/cbp.html" target="_blank">Census Business Patterns</a>
| <a href="https://www.trade.gov/ita-metropolitan-export-series" target="_blank">ITA Metro Exports</a>
{% endblock %}
